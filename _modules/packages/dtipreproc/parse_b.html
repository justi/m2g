

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>packages.dtipreproc.parse_b &mdash; m2g v1.1.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/ocp_favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="m2g v1.1.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../../index.html" class="icon icon-home"> m2g
        

        
          
          <img src="../../../_static/ocp_main.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinx/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinx/local_config.html">Single Node Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#basic-package-update-and-install">Basic Package Update and Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#install-and-configure-python-2-7">Install and Configure Python 2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#basics-for-development">Basics for Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#oracle-java-install">Oracle Java Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#java-setup">Java Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#camino-and-fsl">Camino and FSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#igraph">igraph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#m2g-setup">m2g setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#export-paths-and-setup-environment">Export Paths and Setup Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/local_config.html#running-test-workflow">Running test workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinx/services.html">Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/services.html#using-m2g-on-our-captive-cluster">Using m2g on our captive cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/services.html#using-m2g-in-an-ami">Using m2g in an AMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/services.html#downloading-graphs">Downloading Graphs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinx/ocp.html">NeuroData</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/ocp.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sphinx/ocp.html#style-guides">Style Guides</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinx/faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/data.html">Data Formats</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/data.html#input-data">Input Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/data.html#output-data">Output Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/available_data.html">Public Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/basic_usage.html">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/basic_usage.html#m2g-complete-pipeline">m2g Complete Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/basic_usage.html#m2g-registration-pipeline">m2g Registration Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/basic_usage.html#m2g-diffusion-processing-pipeline">m2g Diffusion Processing Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/advanced_usage.html">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/advanced_usage.html#dti-preprocessing">DTI Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/advanced_usage.html#registration">Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/advanced_usage.html#diffusion-processing">Diffusion Processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/validation.html">Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/validation.html#benchmark-evaluation">Benchmark Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/validation.html#computing-reliability-on-your-data">Computing Reliability on your Data</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Further Reading</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/functions.html">Function Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/bet.html">FSL Brain Extraction Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/flirt.html">FSL Linear Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/parse_b.html">Parse B-values/vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/extract_b0.html">Extract B0 Volume</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/eddycorrect.html">FSL Eddy Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/tensor_gen.html">DTI Tensor Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/fiber_gen.html">Fiber Tractography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/fiber_convert.html">Fiber Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gengraph.html">Graph Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gengraph.html#intuition-behind-graph-generation">Intuition Behind Graph Generation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/downsample_atlas.html">Downsample Atlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/downsample.html">Downsample Graph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference external" href="http://openconnecto.me/graph-services/c4/">Web service</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/openconnectome/m2g">Github repo</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/openconnectome/m2g/releases/">Release Notes</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">m2g</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>packages.dtipreproc.parse_b</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for packages.dtipreproc.parse_b</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="c"># Copyright 2015 Open Connectome Project (http://openconnecto.me)</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c"># you may not use this file except in compliance with the License.</span>
<span class="c"># You may obtain a copy of the License at</span>
<span class="c">#</span>
<span class="c">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">#</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c"># See the License for the specific language governing permissions and</span>
<span class="c"># limitations under the License.</span>
<span class="c">#</span>

<span class="c"># b_format.py</span>
<span class="c"># Created by Greg Kiar on 2015-05-07.</span>
<span class="c"># Email: gkiar@jhu.edu</span>
<span class="c"># Copyright (c) 2015. All rights reserved.</span>



<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">where</span><span class="p">,</span> <span class="n">loadtxt</span><span class="p">,</span> <span class="n">savetxt</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">system</span>

<div class="viewcode-block" id="read_bvals"><a class="viewcode-back" href="../../../api/parse_b.html#packages.dtipreproc.parse_b.read_bvals">[docs]</a><span class="k">def</span> <span class="nf">read_bvals</span><span class="p">(</span><span class="n">b_in</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Parses b-values files provided by the scanner.</span>
<span class="sd">	</span>
<span class="sd">	The b-values received from the scanner indicate both the field intensity during the DTI scanning process as well as the index of the B0 volume. This function identifies both of these values.</span>
<span class="sd">	</span>
<span class="sd">	**Positional Arguments**</span>
<span class="sd">	</span>
<span class="sd">			B-values: [.b; ASCII file]</span>
<span class="sd">					- Ordered list of b-values from the scanner</span>
<span class="sd">	</span>
<span class="sd">	**Returns**</span>
<span class="sd">	</span>
<span class="sd">			B0 Index: [int]</span>
<span class="sd">					- Location of the first B0 volume</span>
<span class="sd">			B: [int]</span>
<span class="sd">					- Field intensity</span>
<span class="sd">			Multiple B0s: [int]</span>
<span class="sd">					- Acts as a flag indicating whether multiple B0 scans exist within the set.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">b</span> <span class="o">=</span> <span class="n">loadtxt</span><span class="p">(</span><span class="n">b_in</span><span class="p">)</span>
	<span class="n">b0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">b</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
	<span class="n">bvalue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">where</span><span class="p">(</span><span class="n">b</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
	<span class="n">lenb</span> <span class="o">=</span>  <span class="nb">len</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">b</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">lenb</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
		<span class="n">lenb</span> <span class="o">=</span> <span class="mi">2</span>
	<span class="k">else</span> <span class="p">:</span>
		<span class="n">lenb</span> <span class="o">=</span> <span class="mi">1</span>

	<span class="n">system</span><span class="p">(</span><span class="s">&quot;echo &#39;b0=(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b0</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;)&#39;&quot;</span><span class="p">)</span>
	<span class="n">system</span><span class="p">(</span><span class="s">&quot;echo &#39;First bvalue=(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">bvalue</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;)&#39;&quot;</span><span class="p">)</span>
	<span class="n">system</span><span class="p">(</span><span class="s">&quot;echo &#39;Multiple B0s (1=no; 2=yes)=(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lenb</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;)&#39;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="format_bvec"><a class="viewcode-back" href="../../../api/parse_b.html#packages.dtipreproc.parse_b.format_bvec">[docs]</a><span class="k">def</span> <span class="nf">format_bvec</span><span class="p">(</span><span class="n">b_in</span><span class="p">,</span> <span class="n">b_out</span><span class="p">):</span>	
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Parses b-vectors (or, gradient direction)  provided by the scanner.</span>
<span class="sd">	</span>
<span class="sd">	B-vectors can be provided in slightly different formats from different scanners, and this module parses them to ensure that downstream functions correctly perceive the information provided.</span>
<span class="sd">	</span>
<span class="sd">	**Positional Arguments**</span>
<span class="sd">	</span>
<span class="sd">			B-vectors: [(bvec), .grad; ASCII file]</span>
<span class="sd">					- Gradient directions of scanner corresponding to the b-values</span>

<span class="sd">	**Returns**</span>

<span class="sd">			Gradients: [(bvec); ASCII file]</span>
<span class="sd">					- Reformatted B-vectors file which is compatible with downstream processing algorithms</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">b</span> <span class="o">=</span> <span class="n">loadtxt</span><span class="p">(</span><span class="n">b_in</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">T</span>
	<span class="n">savetxt</span><span class="p">(</span><span class="n">b_out</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span>  <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.18f</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;bval&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;The b-value file corresponding to the DTI image (.bval, .b)&quot;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;bvec&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;The b-vector/gradient file corresponding to the DTI image (.bvec, .grad)&quot;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;new_bvec&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;The new b-vector/gradient file (.grad)&quot;</span><span class="p">)</span>

  <span class="n">result</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
  <span class="n">read_bvals</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bval</span><span class="p">)</span>
  <span class="n">format_bvec</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bvec</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">new_bvec</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Open Connectome Project.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'v1.1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>